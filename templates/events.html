{% extends "layout.html" %}
{% block title %}Events | Community Connect{% endblock %}

{% block content %}
<div class="bubble-container">
  <div class="bubble" style="min-height: 500px;">
    <h2 class="text-center mb-4">All Events</h2>

    {% if role == "organisation" %}
      <div class="text-end mb-3">
        <a href="{{ url_for('create_event') }}" class="btn btn-success">+ Create Event</a>
      </div>
    {% endif %}

    <ul class="list-group">
      {% for e in events %}
        <li class="list-group-item">
          <strong>{{ e.title }}</strong> (by {{ e.name }})<br>
          <small>{{ e.event_date }} | {{ e.location }}</small><br>
          <span>{{ e.description }}</span><br>
          <span class="badge bg-primary">Volunteers: {{ e.volunteer_count }}</span><br>

          {% if e.skills %}
            <span class="badge bg-info">Skills: {{ e.skills | join(", ") }}</span><br>
          {% endif %}

          <!-- Volunteer Join Button -->
          {% if role == "volunteer" %}
            {% set matching_skills = e.skill_ids | select('in', volunteer_skills) | list %}
            {% if matching_skills %}
              <form method="POST" action="{{ url_for('join_event', event_id=e.event_id) }}" style="display:inline;">
                <button type="submit" class="btn btn-primary btn-sm mt-2">Join Event</button>
              </form>
            {% endif %}
          {% endif %}

          <!-- Organisation Controls -->
          {% if role == "organisation" and session.get('user_id') == e.user_id %}
            <div class="mt-2">
              <!-- Delete button -->
              <form method="POST" action="{{ url_for('delete_event', event_id=e.event_id) }}" style="display:inline;">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
              </form>
              
              <!-- Manage volunteers button -->
              <a href="{{ url_for('manage_event', event_id=e.event_id) }}" class="btn btn-info btn-sm">
                Manage Event
              </a>
            </div>
          {% endif %}
        </li>
      {% else %}
        <li class="list-group-item">No events available yet.</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}

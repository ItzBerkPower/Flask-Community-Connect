{% extends "layout.html" %}
{% block title %}Manage Event | Community Connect{% endblock %}

{% block content %}
<div class="bubble-container">
  <div class="bubble">
    <h2>Manage Event: {{ event.title }}</h2>

    <!-- Volunteer Requests -->
    <h4 class="mt-4">Volunteer Requests</h4>
    {% if requests %}
      <ul class="list-group">
        {% for r in requests %}
          <li class="list-group-item">
            {{ r.full_name }} (Age: {{ r.age }}) — {{ r.email }}
            <span class="badge bg-secondary">{{ r.status }}</span>
            {% if r.status == "pending" %}
              <form method="POST" action="{{ url_for('handle_request', request_id=r.request_id, action='accept') }}" style="display:inline;">
                <button class="btn btn-success btn-sm">Accept</button>
              </form>
              <form method="POST" action="{{ url_for('handle_request', request_id=r.request_id, action='decline') }}" style="display:inline;">
                <button class="btn btn-danger btn-sm">Decline</button>
              </form>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No volunteer requests yet.</p>
    {% endif %}

    <!-- Accepted Volunteers -->
    <h4 class="mt-4">All Volunteers in this Event</h4>
    {% if attendees %}
      <ul class="list-group">
        {% for v in attendees %}
          <li class="list-group-item">
            {{ v.full_name }} (Age: {{ v.age }}) — {{ v.email }}
          </li>
        {% endfor %}
      </ul>

      <!-- ✅ Show average age -->
      <p class="mt-3">
        <strong>Average Age of Volunteers:</strong>
        {% if avg_age %}
          {{ avg_age }} years
        {% else %}
          N/A
        {% endif %}
      </p>
    {% else %}
      <p>No volunteers have joined this event yet.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
